var AssetAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?o(i):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var n=(__define,t),o=n.prototype;return o.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},o.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1,this.isloadover=!1,this.tempstr=new Array,this.tempmusicstr=""}__extends(t,e);var n=(__define,t),o=n.prototype;return o.createChildren=function(){e.prototype.createChildren.call(this);var n=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",n),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/"),!t.isPingTai},o.onConfigComplete=function(e){var n={appId:Info.appDataEyeId};DCAgent.init(n),DCAgent.onEvent("normal_Loading_Enter"),t.gameLayer=new egret.DisplayObjectContainer,this.addChild(t.gameLayer),t.euiLayer=new eui.UILayer,this.addChild(t.euiLayer),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var o=new eui.Theme("resource/default.thm.json",this.stage);o.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},o.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.loadGroup("preload")},o.onResourceLoadComplete=function(e){"loading"==e.groupName&&(DialogManager.open(LoadingView,"LoadingView",1),RES.loadGroup("preload"),NetAPI.Init(),Advert.getInstance().Init()),"preload"==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},o.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.addEventListener(egret.Event.ENTER_FRAME,this.onLoadingWebAudio,this)},o.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},o.onPingTaiStr=function(e){if(egret.log("onPingTaiStr: "+e),Info.uid=e.uid,Info.pass=e.pass,Info.battleId=e.battleId,Info.vsToken=e.vsToken,e.opponents)for(var t=0;t<e.opponents.length;t++)egret.log(t,"onPingTaiStr",e.opponents[t]),e.opponents[t]!=Info.uid&&(Info.matchUid=e.opponents[t],egret.log(Info.uid,Info.battleId,Info.vsToken,Info.matchUid)),0==t&&(GameController.getInstance().isFirstHit=!0);else egret.error("PingTaiStr null!")},o.startCreateScene=function(){t.leveldata_json=RES.getRes("leveldata"),t.teamdata_json=RES.getRes("teamdata"),t.modifydata_json=RES.getRes("modifydata"),t.isPingTai||(NetAPI.Init(),NetManager.instance.Init(),ShareSDK.init(),Advert.getInstance().Init()),this.Init()},o.onLoadingWebAudio=function(){return this.isloadover=LoadAudio(),this.isloadover?(this.startCreateScene(),void this.removeEventListener(egret.Event.ENTER_FRAME,this.onLoadingWebAudio,this)):void 0},o.Init=function(){egret.log("Main Init"),t.isPingTai?(DialogManager.open(GameView,"GameView",1),GameManager.getInstance().PlayNet(),this.addEventListener(egret.Event.ENTER_FRAME,this.onPingTaiEvent,this)):DialogManager.open(GameSelectView,"GameSelectView",1)},o.onPingTaiEvent=function(){Info.isPingtaiStr&&(NetServerConnect.getInstance().ConnectPingTai(),MessageManager.getInstance().LoadPlayerInfo(),this.removeEventListener(egret.Event.ENTER_FRAME,this.onPingTaiEvent,this))},t.isPingTai=!0,t}(eui.UILayer);egret.registerClass(Main,"Main");var GameController=function(){function e(){this.ballSpeedInit=300,this.ballfieldWidth=500,this.ballfieldHeight=800,this.ballNetLength=300,this.stopToNetLength=100,this.shotFrontAngle=60,this.shotMaxDis=125,this.shotMinDis=75,this.shotBeforeTime=100,this.defultHorizontalMaxSpeed=500,this.defultMaxAngle=60,this.handDefaultSpeed=200,this.netAddSelf=0,this.netAddMatch=0,this.isSingle=!1,this.modShotArea=0,this.modHandSpeed=0,this.modBallSpeed=0,this.modGoldSpeed=0,this.ballHitedNum=0,this.isFirstHit=!1,this.levelNum=1,this.isMatchHit=!1,this.AISpeed=500,this.AIHitNum=0,this.handDirArr=new Array,this.perMoveArrX=new Array,this.perMoveArr=new Array,this.oldMoveX=0,this.nowMoveX=0,this.oldMoveY=0,this.nowMoveY=0,this.curHandMoveSpeedX=0,this.curHandMoveSpeed=0,this.curHandMoveDir=0,this.isHandTouch=!1,this.handTouchTime=0,this.temp_BeginX=0,this.temp_BeginY=0,this.temp_MoveX=0,this.temp_MoveY=0,this.temp_EndX=0,this.temp_EndY=0,this.ballSpeed=0,this.ballRotation=0,this.overIsBoss=!1,this.overLoriNum=0}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},n.Init=function(){this.data={originalScore:0,finalScore:0},this.levelNum=1,this.ballHitedNum=0,this.AIHitNum=0,this.ModifyData(),this.GoldPrivilege(),this.GameWaiting(!0)},n.ModifyData=function(){},n.GameWaiting=function(e){GameView.m_UI.waiting.visible=e,e?egret.Tween.get(GameView.m_UI.waiting,{loop:!0}).to({rotation:360},1e3):(egret.Tween.removeTweens(GameView.m_UI.waiting),GameView.m_UI.waiting.rotation=0)},n.GameBegin=function(){this.isSingle=GameManager.getInstance().isSingle,console.log("GameBegin isNet ",GameManager.getInstance().isNet),GameManager.getInstance().TimeBegin(),this.GameWaiting(!1),this.CreatWorld()},n.GoldPrivilege=function(){GameView.m_UI.ballnet_left.height=GameView.m_UI.ballnet_right.height=this.ballNetLength+this.netAddSelf+this.netAddMatch,GameView.m_UI.ballnet_left.y=GameView.m_UI.ballnet_right.y=480-.5*this.ballNetLength-this.netAddMatch},n.CreatWorld=function(){console.log("CreatWorld level ",this.levelNum),this.playerMatch=new Player,this.playerMatch.x=320,this.playerMatch.y=80,this.playerMatch.position=new Vector2(this.playerMatch.x,this.playerMatch.y),this.playerMatch.front=new Vector2(0,-1),this.playerMatch.playerImage.source="player1",this.playerMatch.playerImage.touchEnabled=!1,this.playerSelf=new Player,this.playerSelf.x=320,this.playerSelf.y=880,this.playerSelf.position=new Vector2(this.playerSelf.x,this.playerSelf.y),this.playerSelf.front=new Vector2(0,1),this.playerSelf.playerImage.source="player0",this.ball=new TennisBall,this.isFirstHit?(this.ball.x=320,this.ball.y=360):(this.ball.x=320,this.ball.y=600),GameView.m_UI.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.MoveBeginEvent,this),GameView.m_UI.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.MoveingEvent,this),GameView.m_UI.addEventListener(egret.TouchEvent.TOUCH_END,this.MoveEndEvent,this),GameView.m_UI.addEventListener(egret.Event.ENTER_FRAME,this.FrameEvent,this)},n.FrameEvent=function(){this.SectorRange(),this.HandMoveEvent(),this.isSingle&&this.MatcherAI()},n.MatcherAI=function(){this.playerMatch.position=new Vector2(this.playerMatch.x,this.playerMatch.y);var e=this.playerMatch.position,t=this.ball.position;if(this.ball.y<480){egret.Tween.removeTweens(this.playerMatch);var n=this.AISpeed,o=t.Reduce(e).normlize,i=MyTools.Angle(new Vector2(1,0),o);this.ball.y<this.playerMatch.y&&(i=-i);var a=i*Math.PI/180,r=Math.round(n*Math.cos(a)),s=Math.round(n*Math.sin(a)),l=MyTools.V2Distance(e,t);l<=.5*this.shotMaxDis?(this.ball.ballSpeed=500,this.ball.rotation=30+Math.floor(120*Math.random()),this.isMatchHit||(++this.AIHitNum,this.BallHitedSpeedMod(),this.isMatchHit=!0)):this.isMatchHit||(this.playerMatch.y<=480-this.stopToNetLength?(this.playerMatch.x+=r*GameManager.getInstance().betweenTime*.001,this.playerMatch.y+=s*GameManager.getInstance().betweenTime*.001):this.playerMatch.y=480-this.stopToNetLength)}else egret.Tween.get(this.playerMatch).to({x:320,y:160},1e3)},n.NextLevel=function(){++this.levelNum,this.levelNum>10&&(this.levelNum=10),this.AIHitNum=0,this.AISpeed=500+100*this.levelNum,this.levelNum%2==0?(this.ball.x=320,this.ball.y=360):(this.ball.x=320,this.ball.y=600)},n.SectorRange=function(){var e,t=this.ball.position;if(this.ball.y>=480){this.isMatchHit=!1;var n=new Vector2(this.playerSelf.x,this.playerSelf.y),o=MyTools.V2Distance(n,t);if(e=o,e<=this.shotMinDis&&(this.modShotArea=-.4,this.ball.ballState=BallState.ball_range0),e<=this.shotMaxDis&&e>this.shotMinDis){this.ball.ballImage.source="ball1";var i=t.Reduce(this.playerSelf.position).normlize,a=MyTools.Angle(this.playerSelf.front,i);a<=this.shotFrontAngle?(this.modShotArea=.5,this.ball.ballState=BallState.ball_range2):(this.modShotArea=0,this.ball.ballState=BallState.ball_range1)}e>this.shotMaxDis&&(this.ball.ballImage.source="ball",this.ball.ballState=BallState.ball_free)}else this.ball.ballState=BallState.ball_matchfield},n.HandMoveEvent=function(){if(this.isHandTouch){this.handTouchTime+=GameManager.getInstance().betweenTime,this.oldMoveX=this.nowMoveX,this.nowMoveX=this.temp_MoveX,this.oldMoveY=this.nowMoveY,this.nowMoveY=this.temp_MoveY;var e=this.nowMoveX-this.oldMoveX;this.handDirArr.push(e);var t=Math.abs(e),n=new Vector2(this.nowMoveY-this.oldMoveY,this.nowMoveX-this.oldMoveX),o=Math.round(n.magnitude);this.perMoveArrX.push(t),this.perMoveArr.push(o)}},n.MoveBeginEvent=function(e){this.temp_BeginX=e.stageX,this.temp_BeginY=e.stageY,this.isHandTouch=!0,this.handTouchTime=0,this.perMoveArr.length=0,this.perMoveArrX.length=0,this.handDirArr.length=0},n.MoveingEvent=function(e){if(this.temp_MoveX=e.stageX,this.temp_MoveY=e.stageY,this.playerSelf.y>=480+this.stopToNetLength){if(this.playerSelf.x=this.temp_MoveX,this.playerSelf.y=this.temp_MoveY,this.playerSelf.position=new Vector2(this.playerSelf.x,this.playerSelf.y),GameManager.getInstance().isNet){var t={msgType:1,msg:{x:this.playerSelf.x,y:this.playerSelf.y}},n={type:"sync_data",data:t};console.log("MoveingEvent:",n),NetServerConnect.getInstance().syncBattleOp(n)}}else this.playerSelf.y=480+this.stopToNetLength},n.MoveEndEvent=function(e){this.temp_EndX=e.stageX,this.temp_EndY=e.stageY,this.isHandTouch=!1,this.handDirArr.reverse(),this.perMoveArr.reverse(),this.perMoveArrX.reverse();for(var t=this.shotBeforeTime/this.handTouchTime<1?Math.round((this.perMoveArr.length-1)*(this.shotBeforeTime/this.handTouchTime)):this.perMoveArr.length,n=0,o=0,i=0,a=1;t>a;a++)n+=this.perMoveArr[a],o+=this.perMoveArrX[a],i+=this.handDirArr[a];i>0?i=1:0>i&&(i=-1),this.curHandMoveDir=i,this.curHandMoveSpeed=1e3*n/this.shotBeforeTime,this.curHandMoveSpeedX=1e3*o/this.shotBeforeTime,this.modHandSpeed=.2*Math.floor((this.curHandMoveSpeed-this.handDefaultSpeed)/100),this.modHandSpeed>1&&(this.modHandSpeed=1),(this.ball.ballState==BallState.ball_range0||this.ball.ballState==BallState.ball_range1||this.ball.ballState==BallState.ball_range2)&&this.NetballMove()},n.NetballMove=function(){console.log(this.modShotArea,this.modHandSpeed,this.modBallSpeed,this.modGoldSpeed),this.ballSpeed=this.ballSpeedInit*(1+this.modShotArea+this.modHandSpeed+this.modBallSpeed+this.modGoldSpeed),this.ballSpeed>1500?this.ballSpeed=1500:this.ballSpeed<100&&(this.ballSpeed=100);var e=this.curHandMoveSpeedX,t=this.defultHorizontalMaxSpeed;if(e>t&&(e=t),this.ballRotation=-this.curHandMoveDir*Math.round(this.defultMaxAngle*e/t)-90,console.log("NetballMove: ",this.ballSpeed,this.ballRotation),this.ball.ballSpeed=this.ballSpeed,this.ball.rotation=this.ballRotation,this.BallHitedSpeedMod(),GameManager.getInstance().isNet){var n={msgType:2,msg:{x:this.ball.x,y:this.ball.y,rotation:this.ball.rotation,speed:this.ball.ballSpeed}},o={type:"sync_data",data:n};console.log("NetballMove:",o),NetServerConnect.getInstance().syncBattleOp(o)}},n.BallHitedSpeedMod=function(){++this.ballHitedNum,this.ballHitedNum>=10?this.modBallSpeed+=.05:this.ballHitedNum>=30&&(this.modBallSpeed+=.1),console.log("BallHitedSpeedMod:",this.ballHitedNum,this.modBallSpeed)},n.regulateMatchPos=function(e,t){this.playerMatch.x=640-e,this.playerMatch.y=960-t},n.regulateBallAttribute=function(e,t,n,o){this.ball.x=640-e,this.ball.y=960-t,this.ball.rotation=n-180,this.ball.ballSpeed=o,this.BallHitedSpeedMod()},n.GameOver=function(){this.Calculation(),Main.isPingTai&&MyNet.SubmitData(this.data.originalScore,Info.matchResult)},n.GameEnd=function(){DCAgent.onEvent("normal_Level_Finish"),DialogManager.open(EndView,"EndView",1),GameView.m_UI.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.GameEnd,this)},n.Calculation=function(){console.log("Calculation:",Info.playerScore),this.data.originalScore=Info.playerScore,Main.isPingTai||(Info.SetData(),NetManager.instance.SubmitPlayerScore(this.data.originalScore))},e}();egret.registerClass(GameController,"GameController");var GameManager=function(){function e(){this.allLevelNum=15,this.isPause=!1,this.isGameOver=!1,this.isSingle=!1,this.isNet=!1}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},n.PlaySingle=function(){this.isSingle=!0,this.isNet=!1,GameController.getInstance().GameBegin()},n.PlayNet=function(){this.isSingle=!1,this.isNet=!0,Main.isPingTai||NetServerConnect.getInstance().ConnectWeiXin()},n.TimeBegin=function(){this.oldTime=egret.getTimer(),this.nowTime=egret.getTimer(),Main.euiLayer.addEventListener(egret.Event.ENTER_FRAME,this.TimeFrame,this)},n.TimeEnd=function(){this.betweenTime=0,Main.euiLayer.removeEventListener(egret.Event.ENTER_FRAME,this.TimeFrame,this)},n.TimeFrame=function(){this.oldTime=this.nowTime,this.nowTime=egret.getTimer(),this.betweenTime=this.nowTime-this.oldTime},e.hitTest=function(e,t){var n=e.getBounds(),o=t.getBounds();return n.x=e.x,n.y=e.y,o.x=t.x,o.y=t.y,n.intersects(o)},e}();egret.registerClass(GameManager,"GameManager");var MessageManager=function(){function e(){}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},n.LoadPlayerInfo=function(){Main.isPingTai?(GameView.m_UI.name_self.text=Info.nickname,GameView.m_UI.name_match.text=Info.matchNickname,RES.getResByUrl(Info.iconUrl,this.onGetPicComplete,this,RES.ResourceItem.TYPE_IMAGE),RES.getResByUrl(Info.matchIconUrl,this.onGetMatchPicComplete,this,RES.ResourceItem.TYPE_IMAGE)):(GameView.m_UI.head_self.source=Info.icon,GameView.m_UI.name_self.text=Info.nickname,NetPlayerInfo.getInstance().GetPlayerInfo())},n.onGetPicComplete=function(e){null!=e&&(GameView.m_UI.head_self.source=e)},n.onGetMatchPicComplete=function(e){null!=e&&(GameView.m_UI.head_match.source=e)},n.onBattleStart=function(e){GameController.getInstance().GameBegin()},n.onReceiveInfo=function(e){var t=e.msgType,n=e.msg;if(1==t){var o=n.x,i=n.y;GameController.getInstance().regulateMatchPos(o,i)}else if(2==t){var a=n.x,r=n.y,s=n.rotation,l=n.speed;GameController.getInstance().regulateBallAttribute(a,r,s,l)}},e}();egret.registerClass(MessageManager,"MessageManager");var Player=function(e){function t(){e.call(this),this.commonLength=120,this.Init()}__extends(t,e);var n=(__define,t),o=n.prototype;return o.Init=function(){var e=this.commonLength;this.width=this.height=e,this.anchorOffsetX=this.anchorOffsetY=.5*e,this.touchEnabled=!1,GameView.m_UI.scene_group.addChild(this),this.playerImage=new eui.Image,this.playerImage.width=this.playerImage.height=e,this.playerImage.anchorOffsetX=this.playerImage.anchorOffsetY=.5*e,this.playerImage.x=.5*this.width,this.playerImage.y=.5*this.height,this.addChild(this.playerImage)},t}(eui.Group);egret.registerClass(Player,"Player");var BallState;!function(e){e[e.ball_free=0]="ball_free",e[e.ball_matchfield=1]="ball_matchfield",e[e.ball_range0=2]="ball_range0",e[e.ball_range1=3]="ball_range1",e[e.ball_range2=4]="ball_range2",e[e.ball_fail=5]="ball_fail",e[e.ball_success=6]="ball_success"}(BallState||(BallState={}));var TennisBall=function(e){function t(){e.call(this),this.commonLength=50,this.ballfieldWidth=500,this.ballfieldHeight=800,this.ballNetLength=300,this.ballDirection=0,this.ballSpeed=0,this.ballSpeedX=0,this.ballSpeedY=0,this.Init()}__extends(t,e);var n=(__define,t),o=n.prototype;return o.Init=function(){var e=this.commonLength;this.width=this.height=e,this.anchorOffsetX=this.anchorOffsetY=.5*e,this.x=320,this.y=480,this.position=new Vector2(this.x,this.y),this.touchEnabled=!1,GameView.m_UI.scene_group.addChild(this),this.ballImage=new eui.Image("ball"),this.ballImage.width=this.ballImage.height=e,this.ballImage.anchorOffsetX=this.ballImage.anchorOffsetY=.5*e,this.ballImage.x=.5*this.width,this.ballImage.y=.5*this.height,this.ballImage.touchEnabled=!1,this.addChild(this.ballImage),this.rotation=90,this.ballfieldWidth=GameController.getInstance().ballfieldWidth,this.ballfieldHeight=GameController.getInstance().ballfieldHeight,this.ballNetLength=GameController.getInstance().ballNetLength,this.tempfieldWidth=.5*(640-this.ballfieldWidth),this.tempfieldHeight=.5*(960-this.ballfieldHeight),this.ballState=BallState.ball_free,GameView.m_UI.scene_group.addEventListener(egret.Event.ENTER_FRAME,this.onMoveToFront,this)},o.onMoveToFront=function(){var e=this.tempfieldHeight,t=this.tempfieldWidth,n=.5*this.ballNetLength,o=480-n-GameController.getInstance().netAddMatch,i=480+n+GameController.getInstance().netAddSelf;this.ballDirection=this.rotation;var a=this.ballDirection*Math.PI/180;this.ballSpeedX=Math.round(this.ballSpeed*Math.cos(a)),this.ballSpeedY=Math.round(this.ballSpeed*Math.sin(a)),this.x+=this.ballSpeedX*GameManager.getInstance().betweenTime*.001,this.y+=this.ballSpeedY*GameManager.getInstance().betweenTime*.001,this.position=new Vector2(this.x,this.y),(this.x>640-t||this.x<t)&&(this.y<=i&&this.y>=o?(this.rotation>=0?this.rotation=180-this.ballDirection:this.rotation=-180-this.ballDirection,this.x>640-t?this.x=640-t:this.x<t&&(this.x=t)):(console.log("stopX: ",this.x,this.y),this.ballSpeed=0,this.BallEnd(),GameView.m_UI.scene_group.removeEventListener(egret.Event.ENTER_FRAME,this.onMoveToFront,this))),(this.y>960-e||this.y<e)&&(console.log("stopY: ",this.x,this.y),this.ballSpeed=0,this.BallEnd(),GameView.m_UI.scene_group.removeEventListener(egret.Event.ENTER_FRAME,this.onMoveToFront,this))},o.BallEnd=function(){this.y<480?(console.log("success!"),Info.matchResult="win",Info.playerScore=1):(console.log("fail!"),Info.matchResult="lose",Info.playerScore=0),egret.setTimeout(function(){GameManager.getInstance().isSingle?(GameController.getInstance().NextLevel(),GameView.m_UI.scene_group.addEventListener(egret.Event.ENTER_FRAME,this.onMoveToFront,this)):GameController.getInstance().GameOver()},this,1e3)},t}(eui.Group);egret.registerClass(TennisBall,"TennisBall");var Advert=function(e){function t(){e.apply(this,arguments),this.advert=null,this.imgs={load:[],game:[],end:[]},this.index=0,this.typeArray=["load","game","end"],this.url="http://www.fcbrains.com",this.isAnimation=!1,this.timeoutIndex=0}__extends(t,e);var n=(__define,t),o=n.prototype;return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},o.Init=function(){this.advert=RES.getRes("advert"),null!=this.advert&&this.GetAdvertImg()},o.GetAdvertImg=function(){return-1==this.advert.app.indexOf(Info.app)?(MyDebug.MyLog("~~这个项目没有广告~~"),void console.log("~~这个项目没有广告~~")):(this.DownLoadImg(),void this.ShowAdvert("load"))},o.DownLoadImg=function(){if(0==this.advert[this.typeArray[0]].imgs.length)return this.typeArray.length>1?(this.typeArray.splice(0,1),void this.DownLoadImg()):void 0;console.warn("~~正在下载广告里的图片 当前是 "+this.typeArray[0]+(this.index+1));var e=this.advert[this.typeArray[0]].imgs[this.index];RES.getResByUrl(e,this.DownLoadImgComplete,this)},o.DownLoadImgComplete=function(e){this.imgs[this.typeArray[0]].push(e),this.index++,this.index<this.advert[this.typeArray[0]].imgs.length?this.DownLoadImg():(this.index=0,this.typeArray.splice(0,1),this.typeArray.length>0?this.DownLoadImg():(console.log("~~广告里的图片 已经下载完毕~~"),console.log(this.imgs.load.length+" "+this.imgs.game.length+" "+this.imgs.end.length)))},o.ShowAdvert=function(e){this.RemoveAdvert(),null!=this.advert&&0!=this.advert[e].imgs.length&&null==this.img&&(console.warn("~~准备添加广告~~"),this.img=new eui.Image,this.url=this.advert[e].url,this.img.source=this.imgs[e][0],this.img.width=this.advert[e].width,this.img.height=this.advert[e].height,this.img.x=this.advert[e].x,this.img.y=this.advert[e].y,this.img.alpha=1,this.img.touchEnabled=!0,this.img.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdvertClick,this),Main.gameLayer.addChild(this.img),Main.gameLayer.setChildIndex(this.img,1e4),this.isAnimation=!0,""!=this.advert[e].animation&&this.AdvertTweenAni(e,this.advert[e].animation),this.AdvertAnimation(e))},o.RemoveAdvert=function(){null!=this.img&&(console.warn("~~准备移除广告~~"),this.isAnimation=!1,egret.Tween.removeTweens(this.img),0!=this.timeoutIndex&&egret.clearTimeout(this.timeoutIndex),Main.gameLayer.removeChild(this.img),this.img=null)},o.AdvertAnimation=function(e,t){if(void 0===t&&(t=0),1==this.isAnimation){if(0!=this.timeoutIndex&&egret.clearTimeout(this.timeoutIndex),this.img.texture=this.imgs[e][t%this.advert[e].imgs.length],null!=this.img.texture&&1==this.advert[e].imgs.length)return;t++,this.timeoutIndex=egret.setTimeout(function(){this.AdvertAnimation(e,t)},this,500)}},o.AdvertTweenAni=function(e,t){if("position"==t){var n=this.img.x,o=this.img.y,i=this.advert[e].position.x,a=this.advert[e].position.y,r=this.advert[e].position.time;egret.Tween.get(this.img,{loop:!0}).to({x:i,y:a},r,egret.Ease.quadInOut).wait(200).to({x:n,y:o},r,egret.Ease.quadInOut)}else if("alpha"==t){var r=this.advert[e].alpha.time;egret.Tween.get(this.img,{loop:!0}).to({alpha:0},r).wait(200).to({alpha:1},r)}},o.onAdvertClick=function(){DCAgent.onEvent("normal_Advert_Click"),egret.setTimeout(function(){window.location.href=this.url},this,500)},t}(eui.Group);egret.registerClass(Advert,"Advert");var DialogManager;!function(e){function t(t,n,o){if(void 0===o&&(o=1),1==o){if(""!=this.moment_dict1&&this.dict1[this.moment_dict1].hide(),null==this.dict1[n]){var i=new t;i.show(),this.dict1[n]=i}else this.dict1[n].showing||this.dict1[n].show();this.moment_dict1=n}else if(2==o){if(""!=this.moment_dict2&&this.dict2[this.moment_dict2].hide(),null==this.dict2[n]){var i=new t;i.show(),this.dict2[n]=i}else this.dict2[n].showing||this.dict2[n].show();this.moment_dict2=n,console.log("当前打开",this.moment_dict2)}else if(3==o){if(""!=this.moment_dict3&&this.dict3[this.moment_dict3].hide(),null==this.dict3[n]){var i=new t;i.show(),this.dict3[n]=i}else this.dict3[n].showing||this.dict3[n].show();this.moment_dict3=n}0==o?null==e.hint&&(e.hint=new t,e.hint.show()):null!=e.hint&&(e.hint.hide(),e.hint.show())}function n(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!1),1==t?null!=this.dict1[e]&&(this.dict1[e].parent&&this.dict1[e].hide(),0==n&&(this.dict1[e]=null)):2==t?null!=this.dict2[e]&&(this.dict2[e].parent&&this.dict2[e].hide(),0==n&&(this.dict2[e]=null)):3==t&&null!=this.dict3[e]&&(this.dict3[e].parent&&this.dict3[e].hide(),0==n&&(this.dict3[e]=null))}e.dict1={},e.dict2={},e.dict3={},e.moment_dict0="",e.moment_dict1="",e.moment_dict2="",e.moment_dict3="",e.open=t,e.remove=n}(DialogManager||(DialogManager={}));var Erweima;!function(e){function t(e){function t(){o(),Main.gameLayer.removeChild(i)}var i=new egret.Shape;i.graphics.beginFill(0,.8),i.graphics.drawRect(0,0,640,960),i.graphics.endFill(),Main.gameLayer.addChild(i),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,t,this),n(e)}function n(e){var t=window.innerWidth,n=window.innerHeight,o=document.getElementById("canvasDiv"),i=document.createElement("img");i.width=o.clientWidth/2,i.height=1.17*i.width;var a=t/2-i.width/2,r=n/2-i.height/2;i.id="erweima",i.setAttribute("src","resource/assets/"+e+".png"),i.setAttribute("style","margin:0px;padding:0px;position:absolute;z-index:99999;left:"+a+"px;top:"+r+"px"),document.body.appendChild(i)}function o(){var e=document.getElementById("erweima");document.body.removeChild(e)}e.Show=t}(Erweima||(Erweima={}));var Info;!function(e){function t(t){if(egret.log("Info-onPingTaiStr: "+t),null!=t){e.head=t.head,console.log("client head:",e.head),e.head="dev",e.uid=t.uid,e.pass=t.pass,e.battleId=t.battleId,e.vsToken=t.vsToken,egret.log(e.head,e.uid,e.pass,e.battleId,e.vsToken,t.opponents);for(var n=0;n<t.opponents.length;n++)egret.log(n,"onPingTaiStr",t.opponents[n]),t.opponents[n]!=e.uid&&(e.matchUid=t.opponents[n],0==n&&(GameController.getInstance().isFirstHit=!0));for(var n=0;n<t.opponents_auxInfo.length;n++)t.opponents_auxInfo[n].uid==e.uid?(e.nickname=t.opponents_auxInfo[n].auxInfo.nickname,e.iconUrl="http://"+e.head+".fcbrains.com/files/custom/"+t.opponents_auxInfo[n].auxInfo.usericon,console.log("opponents_auxInfo",n,e.nickname,e.iconUrl)):(e.matchNickname=t.opponents_auxInfo[n].auxInfo.nickname,e.matchIconUrl="http://"+e.head+".fcbrains.com/files/custom/"+t.opponents_auxInfo[n].auxInfo.usericon,console.log("opponents_auxInfo",n,e.matchNickname,e.matchIconUrl));e.isPingtaiStr=!0}}function n(){i={percent:GameController.getInstance().data.originalScore,de:{Info:e.playerScore}}}function o(){var e=JSON.stringify(i);return console.log(e),e}e.app="zzwxr",e.appDataEyeId="",e.head="www",e.fid="",e.nickname="",e.sex="",e.add="",e.iconUrl="",e.isLikeServer=!0,e.averageScore=2,e.standardDeviation=2,e.rank="",e.uid="oqpGVwD8cpATT3CpSjrzLTDP7cz4",e.pass="a1753eb8f0523f2eeb41b1c3dea343c912d56044",e.platform="unip",e.channel="wechat",e.gameId="wqdzz",e.battleId="",e.vsToken="",e.matchNickname="",e.matchIconUrl="",e.playerScore=0,e.matchResult="lose",e.PingtaiStr="",e.isPingtaiStr=!1,e.ReceivePingtaiStr=t;var i;e.SetData=n,e.GetData=o}(Info||(Info={}));var MyDebug;!function(e){function t(e,t){if(console.warn(e+"  "+t),!(i>6))switch(i){case 1:320>e&&480>t&&i++;break;case 2:320>e&&480>t&&i++;break;case 3:e>320&&480>t&&i++;break;case 4:320>e&&t>480&&i++;break;case 5:320>e&&t>480&&i++;break;case 6:e>320&&t>480&&(i++,n())}}function n(){}function o(e){console.log(e)}e.text="";var i=1;e.GetPoint=t,e.MyLog=o}(MyDebug||(MyDebug={}));var MyNet;!function(e){function t(){var t=window.location.href.toString();if(-1!=t.indexOf("nickname")){var o=new Array;o=t.split("&"),e.uid=o[0].split("uid=")[1],e.pass=o[1].split("pass=")[1],e.nickname=o[2].split("nickname=")[1],e.headurl=o[3].split("headimg=")[1],console.log("uid:"+e.uid+" pass:"+e.pass+" nickname:"+e.nickname+" headurl:"+e.headurl),null!=e.headurl&&RES.getResByUrl(e.headurl,n,this,RES.ResourceItem.TYPE_IMAGE)}}function n(t){null!=t&&(e.headimg=t)}function o(e,t){var n="http://"+Info.head+".fcbrains.com?score="+e+"&json="+t;window.location.href=n}e.GetInfo=t,e.SubmitData=o}(MyNet||(MyNet={}));var NetAPI;!function(e){function t(){e.api=RES.getRes("api"),null!=e.api?n():o()}function n(){for(var t in e.api)e.api[t]=e.api[t].replace("%H",Info.head),e.api[t]=e.api[t].replace("%U",Info.uid),e.api[t]=e.api[t].replace("%A",Info.app);NetManager.instance.Init()}function o(){var e=new egret.URLLoader,t=new egret.URLRequest;t.url="http://dev.fcbrains.com/games/family/json/api.json",e.addEventListener(egret.Event.COMPLETE,i,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,a,this),e.load(t)}function i(t){console.log("~~从dev获取API成功~~"),e.api=JSON.parse(t.target.data.toString()),n()}function a(){console.error("~~从dev获取API失败~~")}e.Init=t}(NetAPI||(NetAPI={}));var NetDetailRank=function(){function e(){this.addData=["Beijing","Tianjin","Shanghai","Chongqing","Hebei","Shanxi","Inner Monglolia","Liaoning","Jilin","Heilongjiang","Jiangsu","Zhejiang","Anhui","Fujian","Jiangxi","Shandong","Henan","Hubei","Hunan","Guangdong","Guangxi","Hainan","Sichuan","Guizhou","Yunnan","Tibet","Shaanxi","Gansu","Qinghai","Ningxia","Xinjiang","Hong Kong","Macao","Taiwan","foreign"],this.playerDetailInfo={sex:"",add:"",age:"",edu:""},this.loadRank=new egret.URLLoader}var t=(__define,e),n=t.prototype;return n.CreateRankType=function(){if(this.rankType=new Array,""!=NetManager.instance.sysTime.year){var e=NetManager.instance.sysTime.year+"/"+NetManager.instance.sysTime.month+"/"+NetManager.instance.sysTime.day,t=Week.getWeek(e),n=Info.app+"_rank_"+t;this.rankType.push(n)}console.log("this.addData",this.addData),""!=this.playerDetailInfo.add&&("Inner Monglolia"==this.playerDetailInfo.add?this.rankType.push(Info.app+"_rank_add_InnerMonglolia"):"Hong Kong"==this.playerDetailInfo.add?this.rankType.push(Info.app+"_rank_add_HongKong"):-1!=this.addData.indexOf(this.playerDetailInfo.add)&&this.rankType.push(Info.app+"_rank_add_"+this.playerDetailInfo.add));for(var o in this.rankType)console.warn("this.rankType:"+o);this.rankTypeJson="[";for(var i=0;i<this.rankType.length;i++)this.rankTypeJson+='"'+this.rankType[i]+'"',i<this.rankType.length-1&&(this.rankTypeJson+=",");this.rankTypeJson+="]",console.warn("this.rankTypeJson:  "+this.rankTypeJson)},n.GetxxbgInfo=function(){console.log("~~正在获取玩家附加信息...");var e=new egret.URLLoader,t=new egret.URLRequest;t.url=NetAPI.api.xxbginfo,e.addEventListener(egret.Event.COMPLETE,this.onPlayerDetailInfoLoadComplete,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPlayerDetailInfoLoadError,this),e.load(t)},n.onPlayerDetailInfoLoadComplete=function(e){console.log(e.target.data.toString());var t=JSON.parse(e.target.data.toString());this.playerDetailInfo.sex=Info.sex.toString(),this.playerDetailInfo.add=t.add,this.playerDetailInfo.age=t.age,this.playerDetailInfo.edu=t.edu,(""==this.playerDetailInfo.add||null==this.playerDetailInfo.add)&&(this.playerDetailInfo.add=Info.add),this.CreateRankType(),console.log("add: "+this.playerDetailInfo.add+" age: "+this.playerDetailInfo.age+" edu: "+this.playerDetailInfo.edu+" sex: "+this.playerDetailInfo.sex)},n.onPlayerDetailInfoLoadError=function(){this.playerDetailInfo.sex=Info.sex.toString(),this.playerDetailInfo.add=Info.add,console.error("!!网络连接失败……玩家附加信息获取失败。!!"),MyDebug.MyLog("!!网络连接失败……玩家附加信息获取失败!!"),this.CreateRankType()},n.SubmitPlayerScore=function(e){if(-1==Info.uid.indexOf("error")){var t=new egret.URLRequest(NetAPI.api.multirank);t.method=egret.URLRequestMethod.POST,t.data=new egret.URLVariables("ranknames="+this.rankTypeJson+"&uid="+Info.uid+"&pass="+Info.pass+"&score="+e),console.warn("ranknames="+this.rankTypeJson+"&uid="+Info.uid+"&pass="+Info.pass+"&score="+e),this.loadRank.addEventListener(egret.Event.COMPLETE,this.onSubmitPlayerScoreComplete,this),this.loadRank.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSubmitPlayerScoreError,this),this.loadRank.load(t),console.log("~~正在上传玩家类别排行分数..."),MyDebug.MyLog("~~正在上传玩家类别排行分数...")}},n.onSubmitPlayerScoreComplete=function(){this.loadRank.removeEventListener(egret.Event.COMPLETE,this.onSubmitPlayerScoreComplete,this),this.loadRank.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSubmitPlayerScoreError,this),console.log("~~类别排行数据已上传完成~~"),MyDebug.MyLog("~~类别排行数据已上传完成~~")},n.onSubmitPlayerScoreError=function(){this.loadRank.removeEventListener(egret.Event.COMPLETE,this.onSubmitPlayerScoreComplete,this),this.loadRank.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSubmitPlayerScoreError,this),console.error("！！类别排行数据已上传失败！！"),MyDebug.MyLog("!!类别排行数据已上传失败!!")},e.instance=new e,e}();egret.registerClass(NetDetailRank,"NetDetailRank");var NetManager=function(){function e(){this.InfoJson="",this.sysTime={year:"2000",month:"01",day:"01",hour:"11",minute:"59",second:"59"}}var t=(__define,e),n=t.prototype;return n.Init=function(){console.log("uid="+Info.uid+" pass="+Info.pass),null!=NetAPI.api&&"error"!=Info.uid&&(this.GetFriendUid(),this.GetInfo())},n.GetFriendUid=function(){function e(){console.log("~~上传用户朋友Uid成功~~")}function t(){console.log("!!上传用户朋友Uid失败!!")}if(null!=localStorage.getItem("zqdn_friend_uid")){Info.fid=localStorage.getItem("zqdn_friend_uid"),localStorage.removeItem("zqdn_friend_uid"),console.log("friendUid: "+Info.fid),DCAgent.onEvent("normal_Sharelink_Enter");
var n=new egret.URLLoader,o=new egret.URLRequest(NetAPI.api.addfriend);o.method=egret.URLRequestMethod.POST,o.data=new egret.URLVariables("uid="+Info.uid+"&pass="+Info.pass+"&fuid="+Info.fid),n.addEventListener(egret.Event.COMPLETE,e,this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,t,this),n.load(o),console.log("~~正在上传详细数据...")}},n.GetInfo=function(){null!=localStorage.getItem("zqdn_Info")?(this.InfoJson=localStorage.getItem("zqdn_Info"),console.log("~~本地获取Info~~"),this.PickPlayerDataFromJson()):(console.log("~~网络获取Info~~"),this.ConnectToGetInfo())},n.ConnectToGetInfo=function(){var e=new egret.URLLoader,t=new egret.URLRequest;t.url=NetAPI.api.getginfo,e.addEventListener(egret.Event.COMPLETE,this.onLoadInfoComplete,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.error("网络连接失败……玩家信息获取失败。")},this),e.load(t)},n.onLoadInfoComplete=function(e){this.InfoJson=e.target.data.toString(),this.PickPlayerDataFromJson(),localStorage.setItem("zqdn_Info",this.InfoJson)},n.PickPlayerDataFromJson=function(){console.log(this.InfoJson);var e=JSON.parse(this.InfoJson);Info.nickname=e.nickname,Info.iconUrl=e.headimgurl,Info.sex=e.sex,Info.add=e.province,console.log("name: "+Info.nickname+" id: "+Info.uid),null==Info.nickname||null==Info.iconUrl?console.log("网络连接失败……玩家信息获取失败。"):(console.log("玩家信息Json解析成功"),this.GetPlayerPic())},n.GetPlayerPic=function(){RES.getResByUrl(Info.iconUrl,this.onGetPicComplete,this,RES.ResourceItem.TYPE_IMAGE)},n.onGetPicComplete=function(e){null!=e&&(Info.icon=e),console.log("~~玩家头像获取完成  "+e+"  "+Info.iconUrl)},n.onLoadGameNorm=function(){function e(e){var t=JSON.parse(e.target.data.toString());isNaN(parseFloat(t.averageScore))||isNaN(parseFloat(t.standardDeviation))||(Info.averageScore=parseFloat(t.averageScore),Info.standardDeviation=parseFloat(t.standardDeviation),console.log("网络获取常模成功  averageScore: "+Info.averageScore+" standardDeviation: "+Info.standardDeviation))}function t(){console.error("！！网络获取常模失败！！")}var n=new egret.URLLoader,o=new egret.URLRequest;o.url=NetAPI.api.norm,n.addEventListener(egret.Event.COMPLETE,e,this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,t,this),n.load(o)},n.SubmitPlayerScore=function(e){if(!isNaN(e)&&(this.submitScore=e,Info.rank="",null!=NetAPI.api&&"error"!=Info.uid)){var t=NetAPI.api.newrank;t=t.replace("%R",Info.app+"_rank");var n=new egret.URLLoader,o=new egret.URLRequest(t);o.method=egret.URLRequestMethod.POST,o.data=new egret.URLVariables("uid="+Info.uid+"&pass="+Info.pass+"&score="+e),n.addEventListener(egret.Event.COMPLETE,this.onPostPlayerScoreComplete,this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostPlayerScoreError,this),n.load(o),console.log("~~正在上传玩家分数... "+e),MyDebug.MyLog("~~正在上传玩家分数... "+e)}},n.onPostPlayerScoreComplete=function(e){var t=JSON.parse(e.target.data.toString()),n=parseInt(t.total),o=parseInt(t.rank);console.log(e.target.data.toString()+"all : "+n+" now : "+o),isNaN(n)||isNaN(o)?(console.log("网络获取Json异常……开始本地计算排名..."),MyDebug.MyLog("网络获取Json异常……开始本地计算排名..."),this.CalculateRank(),this.SubmitPlayerDetail()):(1==o?Info.rank="100":Info.rank=((n-1-(o-1))/(n-1)*100).toFixed(2),isNaN(parseFloat(Info.rank))&&(Info.rank="-2"),console.log("~~上传玩家分数、获取用户排名信息完成~~"+e.target.data.toString()+"all : "+n+" now : "+o+" rank: "+Info.rank),this.SubmitPlayerDetail(),NetDetailRank.instance.SubmitPlayerScore(this.submitScore))},n.onPostPlayerScoreError=function(e){this.CalculateRank(),this.SubmitPlayerDetail()},n.CalculateRank=function(){var e=jStat.ztest(this.submitScore,Info.averageScore,Info.standardDeviation,1);GameController.getInstance().data.originalScore>Info.averageScore&&(e=1-e),Info.rank=(100*e).toFixed(2),isNaN(parseFloat(Info.rank))&&(Info.rank="-1"),console.log("原始得分："+this.submitScore+" 平均值："+Info.averageScore+" 标准差："+Info.standardDeviation),console.log("超过百分之"+Info.rank),MyDebug.MyLog("本地计算排行，，超过百分之"+Info.rank)},n.SubmitPlayerDetail=function(){var e=Info.GetData(),t=new egret.URLLoader,n=new egret.URLRequest;n.method=egret.URLRequestMethod.POST,n.url=NetAPI.api.oprecord,n.data=new egret.URLVariables("pass="+Info.pass+"&content="+e),t.addEventListener(egret.Event.COMPLETE,function(e){console.log("~~上传详细数据成功~~")},this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.error("!!网络连接失败……数据未成功上传。!!")},this),t.load(n),console.log("~~正在上传详细数据...")},n.GetIfFollowedServer=function(){console.log("~~正在获取是否 关注公众号~~");var e=new egret.URLLoader,t=new egret.URLRequest;t.url=NetAPI.api.getmpuinfo,e.addEventListener(egret.Event.COMPLETE,this.onFollowedServerComplete,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.error("！！获取是否 关注公众号失败!!")},this),e.load(t)},n.onFollowedServerComplete=function(e){console.log(e.target.data.toString());var t,n=e.target.data.toString();if(-1!=n.indexOf("head")&&-1!=n.indexOf("body")){var o=n.split("<body>")[1];o=o.split("</body>")[0],o=o.replace(new RegExp("&quot;","g"),'"'),console.log(o),t=JSON.parse(o)}else t=JSON.parse(n);1==t.subscribe?(Info.isLikeServer=!0,console.warn("~~获取是否 关注公众号成功  已关注~~"),MyDebug.MyLog("~~获取是否 关注公众号成功  已关注~~")):(Info.isLikeServer=!1,console.warn("~~获取是否 关注公众号成功  未关注~~"),MyDebug.MyLog("~~获取是否 关注公众号成功  未关注~~"))},n.GetSysTime=function(){console.log("~~正在获取服务器时间..."),MyDebug.MyLog("~~正在获取服务器时间...");var e=new egret.URLLoader,t=new egret.URLRequest;t.url=NetAPI.api.time,e.addEventListener(egret.Event.COMPLETE,this.onSysTimeLoadComplete,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSysTimeLoadError,this),e.load(t)},n.onSysTimeLoadComplete=function(e){console.log(e.target.data.toString());var t=JSON.parse(e.target.data.toString()),n=t.time;this.sysTime.year=n.split("/")[0],this.sysTime.month=n.split("/")[1],this.sysTime.day=n.split("/")[2].split(" ")[0],this.sysTime.hour=n.split("/")[2].split(" ")[1].split(":")[0],this.sysTime.minute=n.split("/")[2].split(" ")[1].split(":")[1],this.sysTime.second=n.split("/")[2].split(" ")[1].split(":")[2],console.warn("year:"+this.sysTime.year+" month:"+this.sysTime.month+" day:"+this.sysTime.day+" hour:"+this.sysTime.hour+" minute:"+this.sysTime.minute+" second:"+this.sysTime.second),MyDebug.MyLog("year:"+this.sysTime.year+" month:"+this.sysTime.month+" day:"+this.sysTime.day+" hour:"+this.sysTime.hour+" minute:"+this.sysTime.minute+" second:"+this.sysTime.second),NetDetailRank.instance.GetxxbgInfo()},n.onSysTimeLoadError=function(){console.error("!!获取服务器时间 失败!!"),MyDebug.MyLog("!!获取服务器时间 失败!!"),NetDetailRank.instance.GetxxbgInfo()},e.instance=new e,e}();egret.registerClass(NetManager,"NetManager");var NetPingTaiInfo=function(){function e(){}var t=(__define,e);t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(NetPingTaiInfo,"NetPingTaiInfo");var NetPlayerInfo=function(){function e(){}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},n.GetPlayerInfo=function(){var e=new egret.URLLoader,t=new egret.URLRequest;t.url="http://"+Info.head+".fcbrains.com/ginfo/"+Info.matchUid,e.addEventListener(egret.Event.COMPLETE,this.onLoadInfoComplete,this),e.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.error("网络连接失败……match玩家信息获取失败。")},this),e.load(t)},n.onLoadInfoComplete=function(e){this.InfoJson=e.target.data.toString(),console.log(this.InfoJson);var t=JSON.parse(this.InfoJson);Info.matchNickname=t.nickname,Info.matchIconUrl=t.headimgurl,console.log("matchNickname: "+Info.matchNickname),null==Info.matchNickname||null==Info.matchNickname?console.log("网络连接失败……match玩家信息获取失败。"):(console.log("match玩家信息Json解析成功"),this.GetPlayerPic())},n.GetPlayerPic=function(){RES.getResByUrl(Info.matchIconUrl,this.onGetPicComplete,this,RES.ResourceItem.TYPE_IMAGE)},n.onGetPicComplete=function(e){null!=e&&(GameView.m_UI.head_match.source=e,GameView.m_UI.name_match.text=Info.matchNickname),console.log("~~match玩家头像获取完成  "+e+"  "+Info.iconUrl)},e}();egret.registerClass(NetPlayerInfo,"NetPlayerInfo");var NetPlayerRankInfo=function(){function e(){this.submitPlayerScoreLoader=new egret.URLLoader,this.playerRank=0,this.playerScore=0,this.getPlayerRankLoader=new egret.URLLoader,this.getSelfrRankRangeLoader=new egret.URLLoader,this.selfUids="",this.getSelfInfoLoader=new egret.URLLoader,this.getTopRankRangeLoader=new egret.URLLoader,this.topUids="",this.getTopInfoLoader=new egret.URLLoader}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},n.SubmitPlayerScore=function(){var e=NetAPI.api.newrank;e=e.replace("%R",Info.app+"_rank");var t=new egret.URLRequest(e);t.method=egret.URLRequestMethod.POST,t.data=new egret.URLVariables("uid="+Info.uid+"&pass="+Info.pass+"&score="+Info.playerScore),console.log("playerscore："+t.data),this.submitPlayerScoreLoader.addEventListener(egret.Event.COMPLETE,this.onSubmitPlayerScoreComplete,this),this.submitPlayerScoreLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSubmitPlayerScoreError,this),this.submitPlayerScoreLoader.load(t)},n.onSubmitPlayerScoreComplete=function(e){this.submitPlayerScoreLoader.removeEventListener(egret.Event.COMPLETE,this.onSubmitPlayerScoreComplete,this),this.submitPlayerScoreLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSubmitPlayerScoreError,this),console.warn("onSubmitPlayerScoreComplete"),this.GetPlayerRank()},n.onSubmitPlayerScoreError=function(e){this.submitPlayerScoreLoader.removeEventListener(egret.Event.COMPLETE,this.onSubmitPlayerScoreComplete,this),this.submitPlayerScoreLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSubmitPlayerScoreError,this),console.error("onSubmitPlayerScoreError")},n.GetPlayerRank=function(){var e=NetAPI.api.getbestranks;e=e.replace("%R",Info.app+"_rank");var t=new egret.URLRequest(e);this.getPlayerRankLoader.addEventListener(egret.Event.COMPLETE,this.onGetPlayerRankComplete,this),this.getPlayerRankLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetPlayerRankError,this),this.getPlayerRankLoader.load(t)},n.onGetPlayerRankComplete=function(){this.getPlayerRankLoader.removeEventListener(egret.Event.COMPLETE,this.onGetPlayerRankComplete,this),this.getPlayerRankLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetPlayerRankError,this),console.warn("onGetPlayerRankComplete");var e=this.getPlayerRankLoader.data.toString(),t=JSON.parse(e);console.log("playerRankJson: "+e),MyDebug.MyLog("playerRankJson: "+e),this.playerScore=parseInt(t.score.toString()),this.playerRank=parseInt(t.rank.toString()),console.log("Get playerScore: "+this.playerScore+",playerRank: "+this.playerRank),PlayerRankInfo.getInstance().playerScoreMax=this.playerScore,PlayerRankInfo.getInstance().playerRank=this.playerRank,this.GetSelfRankRange()},n.onGetPlayerRankError=function(){this.getPlayerRankLoader.removeEventListener(egret.Event.COMPLETE,this.onGetPlayerRankComplete,this),this.getPlayerRankLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetPlayerRankError,this),console.error("onGetPlayerRankError")},n.GetSelfRankRange=function(){this.selfUids="";var e=0,t=0;this.playerRank>5?(e=this.playerRank-5,t=this.playerRank+4):(e=1,t=10);var n=NetAPI.api.getbestrankls;n=n.replace("%R",Info.app+"_rank");var o=new egret.URLRequest(n);o.method=egret.URLRequestMethod.POST,o.data=new egret.URLVariables("uid="+Info.uid+"&start="+e+"&stop="+t),this.getSelfrRankRangeLoader.addEventListener(egret.Event.COMPLETE,this.onGetSelfRankRangeComplete,this),this.getSelfrRankRangeLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetSelfRankRangeError,this),this.getSelfrRankRangeLoader.load(o)},n.onGetSelfRankRangeComplete=function(){this.getSelfrRankRangeLoader.removeEventListener(egret.Event.COMPLETE,this.onGetSelfRankRangeComplete,this),this.getSelfrRankRangeLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetSelfRankRangeError,this),console.warn("onGetPlayerRankRangeComplete");var e=this.getSelfrRankRangeLoader.data.toString(),t=JSON.parse(e);console.log("selfRankRangeJson: "+e),PlayerRankInfo.getInstance().selfRange.length=0;for(var n=0;n<t.length;n++)if(null!=t[n]){var o=new PlayerInfo;o._playerUid=t[n].uid,o._playerScore=t[n].score,o._playerRank=t[n].rank,t[n].uid==Info.uid?o._playerBgSource="rank_self":o._playerBgSource="rank_other",PlayerRankInfo.getInstance().selfRange.push(o),n!=t.length-1?this.selfUids+='"'+t[n].uid+'",':this.selfUids+='"'+t[n].uid+'"'}this.selfUids="["+this.selfUids+"]",console.log("selfUids: "+this.selfUids),this.onGetSelfInfo()},n.onGetSelfRankRangeError=function(){this.getSelfrRankRangeLoader.removeEventListener(egret.Event.COMPLETE,this.onGetSelfRankRangeComplete,this),this.getSelfrRankRangeLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetSelfRankRangeError,this),console.error("onGetPlayerRankRangeError")},n.onGetSelfInfo=function(){var e=NetAPI.api.getginfobatch,t=new egret.URLRequest(e);t.method=egret.URLRequestMethod.POST,t.data=new egret.URLVariables("uid="+Info.uid+"&pass="+Info.pass+"&uids="+this.selfUids),this.getSelfInfoLoader.addEventListener(egret.Event.COMPLETE,this.onGetSelfInfoComplete,this),this.getSelfInfoLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetSelfInfoError,this),this.getSelfInfoLoader.load(t)},n.onGetSelfInfoComplete=function(){this.getSelfInfoLoader.removeEventListener(egret.Event.COMPLETE,this.onGetSelfInfoComplete,this),this.getSelfInfoLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetSelfInfoError,this),console.warn("onGetPlayerInfoComplete");var e=JSON.parse(this.getSelfInfoLoader.data);console.log("selfInfoJSON: "+this.getSelfInfoLoader.data);for(var t=0;t<e.length;t++)PlayerRankInfo.getInstance().selfRange[t]._playerName=e[t].info.nickname,PlayerRankInfo.getInstance().selfRange[t]._playerIconUrl=e[t].info.headimgurl;this.GetTopRankRange()},n.onGetSelfInfoError=function(){this.getSelfInfoLoader.removeEventListener(egret.Event.COMPLETE,this.onGetSelfInfoComplete,this),this.getSelfInfoLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetSelfInfoError,this),console.error("onGetPlayerInfoError")},n.GetTopRankRange=function(){this.topUids="";var e=NetAPI.api.getbestrankls;e=e.replace("%R",Info.app+"_rank");var t=new egret.URLRequest(e);t.method=egret.URLRequestMethod.POST,t.data=new egret.URLVariables("uid="+Info.uid+"&start=1&stop=10"),this.getTopRankRangeLoader.addEventListener(egret.Event.COMPLETE,this.onGetTopRankRangeComplete,this),this.getTopRankRangeLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetTopRankRangeError,this),this.getTopRankRangeLoader.load(t)},n.onGetTopRankRangeComplete=function(){this.getTopRankRangeLoader.removeEventListener(egret.Event.COMPLETE,this.onGetTopRankRangeComplete,this),this.getTopRankRangeLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetTopRankRangeError,this),console.warn("onGetTopRankRangeComplete");var e=this.getTopRankRangeLoader.data.toString(),t=JSON.parse(e);console.log("topRankRangeJson: "+e),MyDebug.MyLog("topRankRangeJson: "+e),PlayerRankInfo.getInstance().topRange.length=0;for(var n=0;n<t.length;n++)if(null!=t[n]){var o=new PlayerInfo;o._playerUid=t[n].uid,o._playerScore=t[n].score,o._playerRank=t[n].rank,t[n].uid==Info.uid?o._playerBgSource="rank_self":o._playerBgSource="rank_other",PlayerRankInfo.getInstance().topRange.push(o),n!=t.length-1?this.topUids+='"'+t[n].uid+'",':this.topUids+='"'+t[n].uid+'"'}this.topUids="["+this.topUids+"]",console.log("topUids: "+this.topUids),this.onGetTopInfo()},n.onGetTopRankRangeError=function(){this.getTopRankRangeLoader.removeEventListener(egret.Event.COMPLETE,this.onGetTopRankRangeComplete,this),this.getTopRankRangeLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetTopRankRangeError,this),console.error("onGetTopRankRangeError")},n.onGetTopInfo=function(){var e=NetAPI.api.getginfobatch,t=new egret.URLRequest(e);t.method=egret.URLRequestMethod.POST,t.data=new egret.URLVariables("uid="+Info.uid+"&pass="+Info.pass+"&uids="+this.topUids),this.getTopInfoLoader.addEventListener(egret.Event.COMPLETE,this.onGetTopInfoComplete,this),this.getTopInfoLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetTopInfoError,this),this.getTopInfoLoader.load(t)},n.onGetTopInfoComplete=function(){this.getTopInfoLoader.removeEventListener(egret.Event.COMPLETE,this.onGetTopInfoComplete,this),this.getTopInfoLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetTopInfoError,this),console.warn("onGetTopInfoComplete");var e=JSON.parse(this.getTopInfoLoader.data);console.log("topInfoJSON: "+this.getTopInfoLoader.data);for(var t=0;t<e.length;t++)PlayerRankInfo.getInstance().topRange[t]._playerName=e[t].info.nickname,PlayerRankInfo.getInstance().topRange[t]._playerIconUrl=e[t].info.headimgurl;console.log("所有数据获取完成~~~"),this.FuzhiQuanQiu(),this.FuzhiGaofen()},n.onGetTopInfoError=function(){this.getTopInfoLoader.removeEventListener(egret.Event.COMPLETE,this.onGetTopInfoComplete,this),this.getTopInfoLoader.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetTopInfoError,this),console.error("onGetTopInfoError")},n.FuzhiQuanQiu=function(){for(var e=0;e<PlayerRankInfo.getInstance().selfRange.length;e++){var t=new PlayerDataCell;t.playerdata_head.source=PlayerRankInfo.getInstance().selfRange[e]._playerIconUrl,t.playerdata_rank.text=PlayerRankInfo.getInstance().selfRange[e]._playerRank+"",t.playerdata_name.text=PlayerRankInfo.getInstance().selfRange[e]._playerName+"",t.playerdata_score.text=PlayerRankInfo.getInstance().selfRange[e]._playerScore+"",EndView.m_UI.player_rank_list.addChild(t)}},n.FuzhiGaofen=function(){for(var e=0;e<PlayerRankInfo.getInstance().topRange.length;e++){var t=new PlayerDataCell;t.playerdata_head.source=PlayerRankInfo.getInstance().topRange[e]._playerIconUrl,t.playerdata_rank.text=PlayerRankInfo.getInstance().topRange[e]._playerRank+"",t.playerdata_name.text=PlayerRankInfo.getInstance().topRange[e]._playerName+"",t.playerdata_score.text=PlayerRankInfo.getInstance().topRange[e]._playerScore+"",EndView.m_UI.player_rank_list1.addChild(t)}},e}();egret.registerClass(NetPlayerRankInfo,"NetPlayerRankInfo");var ShareSDK;!function(e){function t(t){e.title=t,s(),l(),h(),c()}function n(){console.log("initShareSDK"),e.title="地球人注意啦，一大波萝莉正在逼近！",g="非常大脑之守护二次元！",e.link="http://"+Info.head+".fcbrains.com/games/"+Info.app+"/index.html?uid="+Info.uid,u="http://"+Info.head+".fcbrains.com/games/"+Info.app+"/img/icon.png",d="http://"+Info.head+".fcbrains.com/"+Info.app+"/mpjsauthinfo",o()}function o(){I=new egret.URLLoader;var e=new egret.URLRequest(d);I.dataFormat=egret.URLLoaderDataFormat.TEXT,e.method=egret.URLRequestMethod.GET,I.addEventListener(egret.Event.CONNECT,i,this),I.addEventListener(egret.Event.COMPLETE,a,this),I.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.error("WeiXin 注入失败!!")},this),I.load(e)}function i(e){console.log("connect")}function a(e){var t=JSON.parse(I.data.toString());console.log(t),f=t.appId,m=t.timestamp,p=t.nonceStr,v=t.signature,r(),s()}function r(){var e=new BodyConfig;e.debug=!1,e.appId=f,e.timestamp=m,e.nonceStr=p,e.signature=v,e.jsApiList=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"],wx.config(e)}function s(){y.title=e.title,y.link=e.link,y.imgUrl=u,y.trigger=function(){},y.success=function(){DCAgent.onEvent("normal_Share_Event")},y.cancel=function(){},y.fail=function(e){},wx.onMenuShareTimeline(y)}function l(){E.title=e.title,E.desc=g,E.link=e.link,E.imgUrl=u,E.trigger=function(){},E.success=function(){DCAgent.onEvent("normal_Share_Event")},E.cancel=function(){},E.fail=function(e){},wx.onMenuShareAppMessage(E)}function h(){S.title=e.title,S.desc=g,S.link=e.link,S.imgUrl=u,S.trigger=function(){},S.complete=function(e){},S.success=function(){DCAgent.onEvent("normal_Share_Event")},S.cancel=function(){},S.fail=function(e){},wx.onMenuShareQQ(S)}function c(){R.title=e.title,R.desc=g,R.link=e.link,R.imgUrl=u,R.trigger=function(){},R.complete=function(e){},R.success=function(){DCAgent.onEvent("normal_Share_Event")},R.cancel=function(){},R.fail=function(e){},wx.onMenuShareWeibo(R)}var d,g,u,f="",p="",m="",v="";e.Update=t,e.init=n;var I,y=new BodyMenuShareTimeline,E=new BodyMenuShareAppMessage,S=new BodyMenuShareQQ,R=new BodyMenuShareWeibo}(ShareSDK||(ShareSDK={}));var UidUrlManager=function(){function e(){}var t=(__define,e);t.prototype;return e.GetCookie=function(e){if(document.cookie.length>0){var t=document.cookie.indexOf(e+"=");if(-1!=t){t=t+e.length+1;var n=document.cookie.indexOf(";",t);-1==n&&(n=document.cookie.length);var o=document.cookie.substring(t,n);return o=o.split('"')[0],void("uid"==e?Info.uid=o:"pass"==e&&(Info.pass=o))}if(null!=localStorage.getItem("zqdn_cookie_uid"))return localStorage.removeItem("zqdn_cookie_uid"),o="error",void("uid"==e?Info.uid=o:"pass"==e&&(Info.pass=o));localStorage.setItem("zqdn_cookie_uid","1")}else{if(null!=localStorage.getItem("zqdn_cookie_uid"))return localStorage.removeItem("zqdn_cookie_uid"),o="error",void("uid"==e?Info.uid=o:"pass"==e&&(Info.pass=o));localStorage.setItem("zqdn_cookie_uid","1")}window.location.href="http://"+Info.head+".fcbrains.com/"+Info.app+"/wxlogin"},e.ChangeURL=function(){var e=window.location.href.toString();if(-1!=e.indexOf("www")?Info.head="www":Info.head="dev",console.log(Info.head),-1!=window.location.href.indexOf("?")||-1!=window.location.href.indexOf("uid")){if(-1!=e.indexOf("uid")){var t=e.split("uid=")[1];-1!=t.indexOf("&")&&(t=t.split("&")[0]),localStorage.setItem("zqdn_friend_uid",t)}return void(window.location.href="http://"+Info.head+".fcbrains.com/games/"+Info.app+"/index.html")}this.GetCookie("uid"),this.GetCookie("pass")},e}();egret.registerClass(UidUrlManager,"UidUrlManager");var Week;!function(e){function t(e){for(var t=new Date(e),o=t.getFullYear(),i=new Date(o+"-01-01"),a=0,r=0;r<t.getMonth();r++)switch(r){case 0:case 2:case 4:case 6:case 7:case 9:a+=31;break;case 1:a+=n(t)?29:28;break;case 3:case 5:case 8:case 10:a+=30}a+=t.getDate();var s=i.getDay(),l=a-(7-s),h=1;return h+=l/7,l%7!=0&&(h+=1),parseInt(h.toString())}function n(e){return 0==e.getFullYear()%4&&(e.getFullYear()%100!=0||e.getFullYear()%400==0)}e.getWeek=t}(Week||(Week={}));var NetServerConnect=function(){function e(){this.pomelo=new Pomelo,this.gataHost="192.168.199.251",this.gataPort="3000",this.hallHost="192.168.199.250",this.hallPort="3010",this.bQuitGameHall=!1,this.vsHost="192.168.199.250",this.vsPort="3030",this.bQuitHall=!1}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==e.instance&&(e.instance=new e,e.instance.onServerMessage()),e.instance},n.ConnectWeiXin=function(){console.log("NetServer--WeiXin"),this.ConnectionGate()},n.ConnectPingTai=function(){egret.log("NetServer--PingTai");var e=this;e.pomelo.disconnect(),e.pomelo.init({host:e.gataHost,port:e.gataPort},function(){console.log("ConnectionGate success"),e.getVSEntry()})},n.ConnectionGate=function(){var e=this;e.pomelo.init({host:e.gataHost,port:e.gataPort},function(){console.log("ConnectionGate success"),e.getHallServerAddress()})},n.getHallServerAddress=function(){var e=this;e.pomelo.request("gate.gateHandler.queryHallEntry",{uid:Info.uid},function(t){console.log("2.getHallServerAddress code: ",t.code),0===t.code&&(console.log("2.getHallServerAddress: ",t),e.hallHost=t.host,e.hallPort=t.port,console.log("2.getHallServerAddress1: ",e.hallHost,e.hallPort),e.pomelo.disconnect(),e.ConnectionHall())})},n.ConnectionHall=function(){var e=this;e.pomelo.init({host:e.hallHost,port:e.hallPort},function(){console.log("4.ConnectionHall success"),e.EnterHall()})},n.EnterHall=function(){var e=this;e.pomelo.request("hallConnector.hallEntryHandler.enter",{platform:Info.platform,channel:Info.channel,uid:Info.uid,pass:Info.pass},function(t){console.log("5.EnterHall code: ",t.code),0===t.code&&(console.log("5.EnterHall:",t),t.gameId?(console.log("5.response.gameId: ",t.gameId,Info.gameId),e.QuitGameHallToEnter()):e.EnterGameHall())})},n.QuitGameHallToEnter=function(){var e=this;e.pomelo.request("hallEngine.hallHandler.leaveGameHall",{force:e.bQuitGameHall},function(t){console.log("QuitGameHallToEnter code: ",t.code),0===t.code||50108===t.code?(console.log("QuitGameHallToEnter success"),e.EnterGameHall()):(e.bQuitGameHall=!0,e.QuitGameHallToEnter(),e.bQuitGameHall=!1)})},n.EnterGameHall=function(){var e=this;e.pomelo.request("hallEngine.hallHandler.enterGameHall",{gameId:Info.gameId,autoJoin:!0},function(t){console.log("6.EnterGameHall code: ",t.code),0===t.code&&(console.log("6.EnterGameHall: ",t),e.gameId=t.gameId,e.tableId=t.table.tableId,e.tableName=t.table.tableName,console.log(e.gameId,e.tableId,e.tableName),e.handlerPlayerReady())})},n.handlerPlayerReady=function(){var e=this;e.pomelo.request("hallEngine.hallHandler.playerReady",{},function(e){console.log("7.handlerPlayerReady code: ",e.code),0===e.code&&console.log("7.handlerPlayerReady success")})},n.getVSEntry=function(){var e=this;e.pomelo.request("gate.gateHandler.queryVsEntry",{uid:Info.uid},function(t){0===t.code&&(console.log("11.getVSEntry: "+t),e.vsHost=t.host,e.vsPort=t.port,console.log("11.getVSEntry1: ",e.vsHost,e.vsPort),e.pomelo.disconnect(),e.ConnectionVS())})},n.ConnectionVS=function(){var e=this;e.pomelo.init({host:e.vsHost,port:e.vsPort},function(){console.log("13.ConnectionVS success"),e.EnterVSHandler()})},n.EnterVSHandler=function(){var e=this;console.log(Info.battleId,Info.uid,Info.vsToken),e.pomelo.request("vsConnector.vsEntryHandler.enter",{battleId:Info.battleId,uid:Info.uid,vsToken:Info.vsToken},function(e){0===e.code&&(console.log("14.EnterVSHandler: "+e),MessageManager.getInstance().onBattleStart(e))})},n.onServerMessage=function(){var e=this;e.pomelo.on("onBattleLaunch",function(t){console.log("8.onBattleLaunch: "+t),Info.battleId=t.battleId,Info.vsToken=t.vsToken;for(var n=0;n<t.opponents.length;n++)t.opponents[n]!=Info.uid&&(Info.matchUid=t.opponents[n],console.log(Info.battleId,Info.vsToken,Info.matchUid),0==n&&(GameController.getInstance().isFirstHit=!0),MessageManager.getInstance().LoadPlayerInfo());e.pomelo.disconnect(),e.pomelo.init({host:e.gataHost,port:e.gataPort},function(){console.log("ConnectionGate success"),e.getVSEntry()})}),e.pomelo.on("onSyncData",function(e){MessageManager.getInstance().onReceiveInfo(e)}),e.pomelo.on("onBattleFinish",function(t){console.log("17.onBattleFinish"+t),e.pomelo.disconnect(),e.pomelo.init({host:e.hallHost,port:e.hallPort},function(){console.log("22.ConnectionHall success"),e.EnterHallToQuit()})})},n.syncBattleOp=function(e){var t=this;console.log("16.syncBattleOp success0--",e),t.pomelo.request("vsEngine.vsEngineHandler.syncBattleOp",e,function(t){0===t.code&&console.log("16.syncBattleOp success",e)})},n.EnterHallToQuit=function(){var e=this;e.pomelo.request("hallConnector.hallEntryHandler.enter",{platform:Info.platform,channel:Info.channel,uid:Info.uid,pass:Info.pass},function(t){0===t.code&&(console.log("23.EnterHallToDrop:",t),e.QuitHall())})},n.QuitHall=function(){var e=this;console.log("QuitHall: ",e.bQuitHall),e.pomelo.request("hallEngine.hallHandler.quit",{force:e.bQuitHall},function(t){console.log("24.QuitHall code",t.code),0===t.code?(console.log("24.QuitHall success"),e.pomelo.disconnect()):(e.bQuitHall=!0,e.QuitHall(),e.bQuitHall=!1)})},e}();egret.registerClass(NetServerConnect,"NetServerConnect");var NetServerPingTai=function(){function e(){this.pomelo=new Pomelo,this.gataHost="192.168.199.251",this.gataPort="3000",this.vsHost="192.168.199.250",this.vsPort="3030",this.bQuitHall=!1}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==e.instance&&(e.instance=new e,e.instance.onServerMessage()),e.instance},n.Init=function(){console.log("NetServer--PingTai")},n.onBattleLaunch=function(){var e=this;e.pomelo.init({host:e.gataHost,port:e.gataPort},function(){console.log("ConnectionGate success"),e.getVSEntry()})},n.getVSEntry=function(){var e=this;e.pomelo.request("gate.gateHandler.queryVsEntry",{uid:Info.uid},function(t){0===t.code&&(console.log("11.getVSEntry: "+t),e.vsHost=t.host,e.vsPort=t.port,egret.log("11.getVSEntry1: ",e.vsHost,e.vsPort),e.pomelo.disconnect(),e.ConnectionVS())})},n.ConnectionVS=function(){var e=this;e.pomelo.init({host:e.vsHost,port:e.vsPort},function(){egret.log("13.ConnectionVS success"),e.EnterVSHandler()})},n.EnterVSHandler=function(){var e=this;console.log(Info.battleId,Info.uid,Info.vsToken),e.pomelo.request("vsConnector.vsEntryHandler.enter",{battleId:Info.battleId,uid:Info.uid,vsToken:Info.vsToken},function(e){0===e.code&&(egret.log("14.EnterVSHandler: "+e),MessageManager.getInstance().onBattleStart(e))})},n.onServerMessage=function(){var e=this;e.pomelo.on("onSyncData",function(e){MessageManager.getInstance().onReceiveInfo(e)})},n.syncBattleOp=function(e){var t=this;t.pomelo.request("vsEngine.vsEngineHandler.syncBattleOp",e,function(e){0===e.code})},n.EnterHallToQuit=function(){var e=this;e.pomelo.request("hallConnector.hallEntryHandler.enter",{platform:Info.platform,channel:Info.channel,uid:Info.uid,pass:Info.pass},function(t){0===t.code&&(console.log("23.EnterHallToDrop:",t),e.QuitHall())})},n.QuitHall=function(){var e=this;console.log("QuitHall: ",e.bQuitHall),e.pomelo.request("hallEngine.hallHandler.quit",{force:e.bQuitHall},function(t){console.log("24.QuitHall code",t.code),0===t.code?(console.log("24.QuitHall success"),e.pomelo.disconnect()):(e.bQuitHall=!0,e.QuitHall(),e.bQuitHall=!1)})},e}();egret.registerClass(NetServerPingTai,"NetServerPingTai");var NetServerWeiXin=function(){function e(){this.pomelo=new Pomelo,this.gataHost="192.168.199.250",this.gataPort="3000",this.hallHost="192.168.199.250",this.hallPort="3010",this.bQuitGameHall=!1,this.vsHost="192.168.199.250",this.vsPort="3030",this.bQuitHall=!1}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==e.instance&&(e.instance=new e,e.instance.onServerMessage()),e.instance},n.Init=function(){console.log("NetServer--WeiXin"),this.ConnectionGate()},n.Connection=function(e,t){this.pomelo.init({host:e,port:t},function(){})},n.DisConnect=function(){this.pomelo.disconnect()},n.ConnectionGate=function(){var e=this;e.pomelo.init({host:e.gataHost,port:e.gataPort},function(){console.log("ConnectionGate success"),e.getHallServerAddress()})},n.getHallServerAddress=function(){var e=this;e.pomelo.request("gate.gateHandler.queryHallEntry",{uid:Info.uid},function(t){console.log("2.getHallServerAddress code: ",t.code),0===t.code&&(console.log("2.getHallServerAddress: ",t),e.hallHost=t.host,e.hallPort=t.port,console.log("2.getHallServerAddress1: ",e.hallHost,e.hallPort),e.pomelo.disconnect(),e.ConnectionHall())})},n.ConnectionHall=function(){var e=this;e.pomelo.init({host:e.hallHost,port:e.hallPort},function(){console.log("4.ConnectionHall success"),e.EnterHall()})},n.EnterHall=function(){var e=this;e.pomelo.request("hallConnector.hallEntryHandler.enter",{platform:Info.platform,channel:Info.channel,uid:Info.uid,pass:Info.pass},function(t){console.log("5.EnterHall code: ",t.code),0===t.code&&(console.log("5.EnterHall:",t),t.gameId?(console.log("5.response.gameId: ",t.gameId,Info.gameId),e.QuitGameHallToEnter()):e.EnterGameHall())})},n.QuitGameHallToEnter=function(){var e=this;e.pomelo.request("hallEngine.hallHandler.leaveGameHall",{force:e.bQuitGameHall},function(t){console.log("QuitGameHallToEnter code: ",t.code),0===t.code||50108===t.code?(console.log("QuitGameHallToEnter success"),e.EnterGameHall()):(e.bQuitGameHall=!0,e.QuitGameHallToEnter(),e.bQuitGameHall=!1)})},n.EnterGameHall=function(){var e=this;
e.pomelo.request("hallEngine.hallHandler.enterGameHall",{gameId:Info.gameId,autoJoin:!0},function(t){console.log("6.EnterGameHall code: ",t.code),0===t.code&&(console.log("6.EnterGameHall: ",t),e.gameId=t.gameId,e.tableId=t.table.tableId,e.tableName=t.table.tableName,console.log(e.gameId,e.tableId,e.tableName),e.handlerPlayerReady())})},n.handlerPlayerReady=function(){var e=this;e.pomelo.request("hallEngine.hallHandler.playerReady",{},function(e){console.log("7.handlerPlayerReady code: ",e.code),0===e.code&&console.log("7.handlerPlayerReady success")})},n.getVSEntry=function(){var e=this;e.pomelo.request("gate.gateHandler.queryVsEntry",{uid:Info.uid},function(t){0===t.code&&(console.log("11.getVSEntry: "+t),e.vsHost=t.host,e.vsPort=t.port,console.log("11.getVSEntry1: ",e.vsHost,e.vsPort),e.pomelo.disconnect(),e.ConnectionVS())})},n.ConnectionVS=function(){var e=this;e.pomelo.init({host:e.vsHost,port:e.vsPort},function(){console.log("13.ConnectionVS success"),e.EnterVSHandler()})},n.EnterVSHandler=function(){var e=this;console.log(Info.battleId,Info.uid,Info.vsToken),e.pomelo.request("vsConnector.vsEntryHandler.enter",{battleId:Info.battleId,uid:Info.uid,vsToken:Info.vsToken},function(e){0===e.code&&(console.log("14.EnterVSHandler: "+e),MessageManager.getInstance().onBattleStart(e))})},n.onServerMessage=function(){var e=this;e.pomelo.on("onBattleLaunch",function(t){console.log("8.onBattleLaunch: "+t),Info.battleId=t.battleId,Info.vsToken=t.vsToken;for(var n=0;n<t.opponents.length;n++)t.opponents[n]!=Info.uid&&(Info.matchUid=t.opponents[n],console.log(Info.battleId,Info.vsToken,Info.matchUid),0==n&&(GameController.getInstance().isFirstHit=!0),MessageManager.getInstance().LoadPlayerInfo());e.pomelo.disconnect(),e.pomelo.init({host:e.gataHost,port:e.gataPort},function(){console.log("ConnectionGate success"),e.getVSEntry()})}),e.pomelo.on("onSyncData",function(e){MessageManager.getInstance().onReceiveInfo(e)}),e.pomelo.on("onBattleFinish",function(t){console.log("17.onBattleFinish"+t),e.pomelo.disconnect(),e.pomelo.init({host:e.hallHost,port:e.hallPort},function(){console.log("22.ConnectionHall success"),e.EnterHallToQuit()})})},n.syncBattleOp=function(e){var t=this;t.pomelo.request("vsEngine.vsEngineHandler.syncBattleOp",e,function(e){0===e.code})},n.EnterHallToQuit=function(){var e=this;e.pomelo.request("hallConnector.hallEntryHandler.enter",{platform:Info.platform,channel:Info.channel,uid:Info.uid,pass:Info.pass},function(t){0===t.code&&(console.log("23.EnterHallToDrop:",t),e.QuitHall())})},n.QuitHall=function(){var e=this;console.log("QuitHall: ",e.bQuitHall),e.pomelo.request("hallEngine.hallHandler.quit",{force:e.bQuitHall},function(t){console.log("24.QuitHall code",t.code),0===t.code?(console.log("24.QuitHall success"),e.pomelo.disconnect()):(e.bQuitHall=!0,e.QuitHall(),e.bQuitHall=!1)})},e}();egret.registerClass(NetServerWeiXin,"NetServerWeiXin");var ServerEvent=function(){function e(){}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},n.FirstHitRandom=function(){},e}();egret.registerClass(ServerEvent,"ServerEvent");var ThemeAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getTheme=function(e,t,n,o){function i(e){t.call(o,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(o))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var EffectMoveClip=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),o=n.prototype;return o.init=function(e,t){var n=RES.getRes(e),o=RES.getRes(t);this.mcf=new egret.MovieClipDataFactory(n,o),this.mc=new egret.MovieClip,this.mc.movieClipData=this.mcf.generateMovieClipData(),this.addChild(this.mc)},o.removeMC=function(e){null!=this.parent&&this.parent.removeChild(this)},o.PlayAnimation=function(e){this.mc.play(e),1==e&&this.mc.addEventListener(egret.Event.COMPLETE,this.removeMC,this)},t}(egret.Sprite);egret.registerClass(EffectMoveClip,"EffectMoveClip");var MyTools=function(){function e(){}var t=(__define,e);t.prototype;return e.V2Magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},e.V2Multi=function(e,t){return e.x*t.x+e.y*t.y},e.Angle=function(e,t){var n=this.V2Multi(e,t),o=this.V2Magnitude(e)*this.V2Magnitude(t),i=Math.acos(n/o);return Math.round(180*i/Math.PI)},e.V2Distance=function(e,t){var n=e.x-t.x,o=e.y-t.y,i=Math.sqrt(n*n+o*o);return i},e.SortNumTurnBig=function(e){return e.sort(function(e,t){return t-e})},e.SortNumTurnSmall=function(e){return e.sort(function(e,t){return e-t})},e}();egret.registerClass(MyTools,"MyTools");var PlayerDataCell=function(e){function t(){e.call(this),this.Init()}__extends(t,e);var n=(__define,t),o=n.prototype;return o.Init=function(){this.width=500,this.height=70;var e=new eui.Image;e.source="rank_other",e.width=480,e.height=70,e.x=10,e.y=0,this.addChild(e),this.playerdata_rank=new eui.Label,this.playerdata_rank.text="",this.playerdata_rank.size=25,this.playerdata_rank.fontFamily="微软雅黑",this.playerdata_rank.textColor=2452842,this.playerdata_rank.textAlign="center",this.playerdata_rank.width=100,this.playerdata_rank.height=60,this.playerdata_rank.x=10,this.playerdata_rank.y=20,this.addChild(this.playerdata_rank),this.playerdata_head=new eui.Image,this.playerdata_head.source="player_head_bg",this.playerdata_head.width=this.playerdata_head.height=65,this.playerdata_head.x=110,this.playerdata_head.y=2,this.addChild(this.playerdata_head),this.playerdata_name=new eui.Label,this.playerdata_name.text="",this.playerdata_name.size=20,this.playerdata_name.fontFamily="微软雅黑",this.playerdata_name.textColor=2452842,this.playerdata_name.textAlign="center",this.playerdata_name.width=200,this.playerdata_name.height=40,this.playerdata_name.x=180,this.playerdata_name.y=20,this.addChild(this.playerdata_name),this.playerdata_score=new eui.Label,this.playerdata_score.text="",this.playerdata_score.size=20,this.playerdata_score.fontFamily="微软雅黑",this.playerdata_score.textColor=2452842,this.playerdata_score.textAlign="center",this.playerdata_score.width=150,this.playerdata_score.height=60,this.playerdata_score.x=350,this.playerdata_score.y=20,this.addChild(this.playerdata_score)},t}(eui.Group);egret.registerClass(PlayerDataCell,"PlayerDataCell");var PlayerRankInfo=function(){function e(){this.playerScoreMax=0,this.playerRank=0,this.topRange=new Array,this.selfRange=new Array}var t=(__define,e);t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(PlayerRankInfo,"PlayerRankInfo");var PlayerInfo=function(){function e(){this._playerUid="",this._playerRank=0,this._playerIconUrl="",this._playerName="",this._playerScore=0,this._playerBgSource=""}var t=(__define,e);t.prototype;return e}();egret.registerClass(PlayerInfo,"PlayerInfo");var Vector2=function(){function e(e,t){this.x=e,this.y=t}var t=__define,n=e,o=n.prototype;return t(o,"magnitude",function(){return Math.sqrt(this.x*this.x+this.y*this.y)}),t(o,"normlize",function(){var t=this.x/this.magnitude,n=this.y/this.magnitude;return new e(t,n)}),o.Reduce=function(t){var n=Math.round(this.x-t.x),o=Math.round(t.y-this.y);return new e(n,o)},e}();egret.registerClass(Vector2,"Vector2");var View=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var n=(__define,t),o=n.prototype;return o.show=function(){this.parent||Main.euiLayer.addChild(this)},o.hide=function(){this.parent&&Main.euiLayer.removeChild(this)},t}(eui.Group);egret.registerClass(View,"View");var EndView=function(e){function t(){e.call(this),DialogManager.remove("GameView")}__extends(t,e);var n=(__define,t),o=n.prototype;return o.createChildren=function(){e.prototype.createChildren.call(this),t.m_UI=new EndViewSkin,this.addChild(t.m_UI),Advert.getInstance().ShowAdvert("end"),t.m_UI.end_again.touchEnabled=!0,t.m_UI.end_more.touchEnabled=!0,t.m_UI.end_again.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtnAnimator,this),t.m_UI.end_more.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBtnAnimator,this),t.m_UI.rankButton_quanqiu.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuanQiu,this),t.m_UI.rankButton_gaofen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGaoFen,this),t.m_UI.curScore_label.text=Info.playerScore.toString(),this.ChangeShare(),NetPlayerRankInfo.getInstance().SubmitPlayerScore()},o.isAndroidAgents=function(){var e=window.navigator.userAgent.toLowerCase();if(""+e.match(/android/i)=="android"){console.log("true");var t="http://www.fcbrains.com/web/kjyx/dl/index.html";window.location.href=t}else{console.log("false");var t="http://www.fcbrains.com/web/kjyx/dl/index.html";window.location.href=t}},o.onClickBtnAnimator=function(e){e.target.touchEnabled=!1;var t=e.currentTarget._source.toString(),n=e.target;n.scaleX=n.scaleY=1,egret.Tween.get(n,{loop:!1}).to({scaleX:1.1,scaleY:1.1},100).to({scaleX:1,scaleY:1},100).call(function(){switch(t){case"TryAgain":this.tryAgain();break;case"more":this.more();break;case"detail":this.detail();break;case"share":this.rankSystem()}},this)},o.tryAgain=function(){console.log("再试一次"),DCAgent.onEvent("normal_Again_Click"),egret.setTimeout(function(){DialogManager.open(GameView,"GameView",1)},this,500)},o.more=function(){console.log("返回首页"),DCAgent.onEvent("normal_More_Click"),egret.setTimeout(function(){var e="http://"+Info.head+".fcbrains.com/games/zqdn/index.html";window.location.href=e},this,500)},o.detail=function(){console.log("返回潜能分析"),egret.setTimeout(function(){var e="http://"+Info.head+".fcbrains.com/games/fkxt/index.html";window.location.href=e},this,500)},o.rankSystem=function(){console.log("返回排行榜"),egret.setTimeout(function(){var e="http://"+Info.head+".fcbrains.com/games/phxt/index.html";window.location.href=e},this,500)},o.ChangeShare=function(){var e="俺们二次元中出了一个"+Info.playerScore+"分的叛徒，快抓住TA！";ShareSDK.Update(e)},o.onQuanQiu=function(){t.m_UI.rankButton_gaofen.source="player_rank0",t.m_UI.rankButton_quanqiu.source="player_rank1",t.m_UI.player_rank_list.visible=!0,t.m_UI.player_rank_list1.visible=!1},o.onGaoFen=function(){t.m_UI.rankButton_quanqiu.source="player_rank0",t.m_UI.rankButton_gaofen.source="player_rank1",t.m_UI.player_rank_list.visible=!1,t.m_UI.player_rank_list1.visible=!0},t}(View);egret.registerClass(EndView,"EndView");var EndViewSkin=function(e){function t(){e.call(this),this.skinName="src/skins/EndSkin.exml"}__extends(t,e);var n=(__define,t),o=n.prototype;return o.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t}(eui.Component);egret.registerClass(EndViewSkin,"EndViewSkin");var GameSelectView=function(e){function t(){e.call(this)}__extends(t,e);var n=(__define,t),o=n.prototype;return o.createChildren=function(){e.prototype.createChildren.call(this),t.m_UI=new GameSelectViewSkin,this.addChild(t.m_UI),t.m_UI.select_single.addEventListener(egret.TouchEvent.TOUCH_TAP,this.SelectSingle,this),t.m_UI.select_net.addEventListener(egret.TouchEvent.TOUCH_TAP,this.SelectNet,this)},o.SelectSingle=function(){DialogManager.open(GameView,"GameView",1),GameManager.getInstance().PlaySingle()},o.SelectNet=function(){DialogManager.open(GameView,"GameView",1),GameManager.getInstance().PlayNet()},t}(View);egret.registerClass(GameSelectView,"GameSelectView");var GameSelectViewSkin=function(e){function t(){e.call(this),this.skinName="src/skins/GameSelectSkin.exml"}__extends(t,e);var n=(__define,t),o=n.prototype;return o.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t}(eui.Component);egret.registerClass(GameSelectViewSkin,"GameSelectViewSkin");var GameView=function(e){function t(){e.call(this),DialogManager.remove("EndView")}__extends(t,e);var n=(__define,t),o=n.prototype;return o.createChildren=function(){e.prototype.createChildren.call(this),t.m_UI=new GameViewSkin,this.addChild(t.m_UI),t.m_UI.waiting.width=t.m_UI.waiting.height=200,t.m_UI.waiting.anchorOffsetX=t.m_UI.waiting.anchorOffsetY=.5*t.m_UI.waiting.width,t.m_UI.waiting.x=320,t.m_UI.waiting.y=480,GameController.getInstance().Init()},t}(View);egret.registerClass(GameView,"GameView");var GameViewSkin=function(e){function t(){e.call(this),this.skinName="src/skins/GameSkin.exml"}__extends(t,e);var n=(__define,t),o=n.prototype;return o.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t}(eui.Component);egret.registerClass(GameViewSkin,"GameViewSkin");var LoadingView=function(e){function t(){e.call(this),this.loadingText=["l","o","a","d","i","n","g","1","2","3"],this.isHide=!1,this.logoLeftAniIndex=0}__extends(t,e);var n=(__define,t),o=n.prototype;return o.createChildren=function(){e.prototype.createChildren.call(this),this.m_UI=new LoadingViewSkin,this.addChild(this.m_UI),this.LoadingAni(),this.LogoLeftAni(),egret.Tween.get(this.m_UI.logo_right,{loop:!0}).to({rotation:360},3e3)},o.LoadingAni=function(){if(!this.isHide){for(var e=0;e<this.loadingText.length;e++)egret.Tween.get(this.m_UI["loading_"+this.loadingText[e]]).wait(300*e).to({y:435},120,egret.Ease.quadOut).wait(60).to({y:450},60,egret.Ease.quintOut);egret.setTimeout(this.LoadingAni,this,300*this.loadingText.length)}},o.LogoLeftAni=function(){this.isHide||(this.logoLeftAniIndex=(this.logoLeftAniIndex+1)%24,this.m_UI.logo_left.source="logo_left.logo_ani_"+this.logoLeftAniIndex,egret.setTimeout(this.LogoLeftAni,this,41.7))},o.LogoGroupAni=function(){},t}(View);egret.registerClass(LoadingView,"LoadingView");var LoadingViewSkin=function(e){function t(){e.call(this),this.skinName="src/skins/LoadingSkin.exml"}__extends(t,e);var n=(__define,t),o=n.prototype;return o.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t}(eui.Component);egret.registerClass(LoadingViewSkin,"LoadingViewSkin");